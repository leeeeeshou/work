<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 æ‹¾å…‰æœˆè¨˜</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* å¥¶èŒ¶è‰²ç³»èª¿è‰²ç›¤ */
            --bg-color: #FDFBF7;         /* ç±³ç™½èƒŒæ™¯ */
            --primary-color: #D4C1A5;    /* å¥¶èŒ¶è‰² */
            --secondary-color: #E8DCC8;  /* æ·ºå¥¶èŒ¶ */
            --accent-color: #9C8163;     /* æ·±å’–å•¡æ–‡å­— */
            --highlight-pink: #F4C2C2;   /* äº®è‰²é»ç¶´ - æŸ”ç²‰ */
            --highlight-green: #B7D1A2;  /* äº®è‰²é»ç¶´ - é…ªæ¢¨ç¶  */
            --card-bg: #FFFFFF;
            --font-main: 'Quicksand', 'Noto Sans TC', sans-serif;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--accent-color);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
            background-image: radial-gradient(#D4C1A5 1px, transparent 1px);
            background-size: 20px 20px; /* é»é»èƒŒæ™¯ */
        }

        /* æ¨™é¡Œå€ */
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
        }

        h1 {
            font-size: 2.5rem;
            color: var(--accent-color);
            text-shadow: 2px 2px 0px var(--secondary-color);
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1rem;
            background-color: var(--highlight-green);
            color: #fff;
            padding: 5px 15px;
            border-radius: 20px;
            display: inline-block;
        }

        /* æ ¼ç·šä½ˆå±€ */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            padding-bottom: 80px; /* ç‚ºåº•éƒ¨æŒ‰éˆ•ç•™ç©ºé–“ */
        }

        /* åŒ¯å‡ºæ™‚çš„å®¹å™¨èª¿æ•´ */
        .journal-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* æœˆä»½å¡ç‰‡ */
        .month-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 16px rgba(156, 129, 99, 0.1);
            border: 3px solid var(--secondary-color);
            transition: transform 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .month-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-color);
        }

        .month-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            border-bottom: 2px dashed var(--secondary-color);
            padding-bottom: 10px;
        }

        .month-tag {
            background-color: var(--primary-color);
            color: white;
            padding: 5px 12px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 1.2rem;
        }

        /* è¼¸å…¥æ¬„ä½æ¨£å¼ */
        input[type="text"], textarea {
            width: 100%;
            border: 2px solid #EEE;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 10px;
            font-family: var(--font-main);
            box-sizing: border-box;
            background: #FAFAFA;
            color: var(--accent-color);
            transition: 0.3s;
        }

        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: var(--highlight-pink);
            background: #FFF;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* åœ–ç‰‡ä¸Šå‚³å€ */
        .img-upload-area {
            position: relative;
            width: 100%;
            /* é€™è£¡è¨­å®šçµ±ä¸€çš„æ¯”ä¾‹ï¼Œ4/3 æ˜¯æ¨™æº–ç…§ç‰‡æ¯”ä¾‹ï¼Œä¹Ÿå¯ä»¥æ”¹æˆ 1/1 (æ­£æ–¹å½¢) */
            aspect-ratio: 4/3; 
            background-color: #F7F5F0;
            border: 2px dashed var(--primary-color);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            overflow: hidden;
            transition: 0.3s;
        }

        .img-upload-area:hover {
            background-color: #FFF;
            border-color: var(--highlight-pink);
        }

        /* ç•¶æœ‰åœ–ç‰‡æ™‚çš„æ¨£å¼ä¿®æ­£ */
        .img-upload-area.has-image {
            display: block;
            padding: 0;
            border-style: solid;
    /* ä¸å†ä½¿ç”¨ autoï¼Œè€Œæ˜¯å¼·åˆ¶éµå®ˆä¸Šé¢çš„ aspect-ratio */
        }

        .img-upload-area img {
            width: 100%;
            height: 100%; /* å¼·åˆ¶å¡«æ»¿å®¹å™¨é«˜åº¦ */
            object-fit: cover; 
            object-position: center; /* å¾ä¸­é–“é–‹å§‹è£åˆ‡ */
            display: none;
            border-radius: 13px;
        }

        .upload-placeholder {
            text-align: center;
            color: #AAA;
        }

        .upload-input {
            display: none;
        }

        /* åº•éƒ¨æ§åˆ¶åˆ— */
        .control-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            text-align: center;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.05);
            z-index: 100;
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .btn-download {
            background-color: var(--highlight-pink);
            color: #FFF;
        }
        
        .btn-download:hover { background-color: #ff9e9e; }

        .btn-pdf {
            background-color: var(--primary-color);
            color: #FFF;
        }

        .btn-pdf:hover { background-color: #c4aa88; }

        /* å¼•å° Modal */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(93, 64, 55, 0.7);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: #FFF;
            width: 90%;
            max-width: 500px;
            border-radius: 25px;
            padding: 30px;
            text-align: center;
            border: 5px solid var(--primary-color);
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .modal-content h2 {
            color: var(--accent-color);
        }

        .modal-content p {
            color: #666;
            margin-bottom: 10px;
            text-align: left;
        }

        .step-icon {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: var(--highlight-pink);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            margin-right: 10px;
            font-weight: bold;
        }

        @keyframes popIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .export-text-div {
            width: 100%;
            border: 2px solid #EEE; /* ä¿æŒåŸæœ¬çš„æ¡†ç·š */
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 10px;
            font-family: var(--font-main);
            background: #FFF; /* åŒ¯å‡ºæ™‚èƒŒæ™¯æ”¹ç‚ºå…¨ç™½æ¯”è¼ƒæ¸…æ¥š */
            color: var(--accent-color);
            box-sizing: border-box;
            font-size: 1rem; /* ç¢ºä¿å­—é«”å¤§å°ä¸€è‡´ */
            line-height: 1.6;
            min-height: 45px; /* ç¢ºä¿æ¨™é¡Œæœ‰è¶³å¤ é«˜åº¦ */
            white-space: pre-wrap; /* ä¿ç•™ textarea çš„æ›è¡Œ */
            word-wrap: break-word; /* é˜²æ­¢é•·å­—ä¸²ç ´ç‰ˆ */
        }
        .export-image-div {
            width: 100%;
            height: 100%;
            background-size: cover;    /* è®“èƒŒæ™¯åœ–è‡ªå‹•è£åˆ‡å¡«æ»¿ */
            background-position: center; /* å±…ä¸­å°é½Š */
            border-radius: 13px;       /* ä¿æŒåœ“è§’ */
        }
    </style>
</head>
<body>

    <header id="main-header">
        <h1>2025 æ‹¾å…‰æœˆè¨˜</h1>
        <div class="subtitle">âœ¨ ç´€éŒ„æ¯ä¸€å€‹é–ƒé–ƒç™¼äº®çš„æ—¥å­ âœ¨</div>
    </header>

    <div class="container" id="journal-container">
        </div>

    <div class="control-bar data-html2canvas-ignore">
        <button class="btn btn-download" onclick="exportToImage()">ğŸ“¸ ä¸‹è¼‰é•·åœ– (JPG)</button>
        <button class="btn btn-pdf" onclick="exportToPDF()">ğŸ“„ åŒ¯å‡º PDF</button>
        <button class="btn" style="background:#ddd; color:#555;" onclick="clearData()">ğŸ—‘ï¸ æ¸…é™¤é‡å¯«</button>
    </div>

    <div class="modal-overlay" id="intro-modal">
        <div class="modal-content">
            <h2>ğŸ‘‹ æ­¡è¿ä¾†åˆ°æ‚¨çš„ 2025 æœˆè¨˜ï¼</h2>
            <p style="text-align: center; margin-bottom: 20px;">é€™è£¡æ²’æœ‰è¤‡é›œçš„æ“ä½œï¼Œåªæœ‰æº«æš–çš„ç´€éŒ„ã€‚</p>
            
            <p><span class="step-icon">1</span> <b>å¯«ä¸‹æ¨™é¡Œ</b>ï¼šå¹«é€™å€‹æœˆä¸‹ä¸€å€‹ä¸»é¡Œã€‚</p>
            <p><span class="step-icon">2</span> <b>ä¸Šå‚³ç…§ç‰‡</b>ï¼šé»æ“Šè™›ç·šæ¡†æ¡†ï¼Œæ”¾ä¸Šä¸€å¼µä»£è¡¨ç…§ã€‚</p>
            <p><span class="step-icon">3</span> <b>è‡ªå‹•ä¿å­˜</b>ï¼šä¸ç”¨æ“”å¿ƒï¼Œæ‰“å­—å¾Œæˆ‘å€‘æœƒè‡ªå‹•å¹«æ‚¨æš«å­˜åœ¨ç€è¦½å™¨è£¡ã€‚</p>
            <p><span class="step-icon">4</span> <b>ä¸€éµåŒ¯å‡º</b>ï¼šå¹´åº•æˆ–éš¨æ™‚ï¼Œé»æ“Šä¸‹æ–¹æŒ‰éˆ•å³å¯æ‰“åŒ…å¸¶èµ°ã€‚</p>
            
            <button class="btn btn-download" style="margin-top: 20px;" onclick="closeModal()">é–‹å§‹ç´€éŒ„ âœï¸</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        const container = document.getElementById('journal-container');
        const months = [
            "January 1æœˆ", "February 2æœˆ", "March 3æœˆ", "April 4æœˆ", 
            "May 5æœˆ", "June 6æœˆ", "July 7æœˆ", "August 8æœˆ", 
            "September 9æœˆ", "October 10æœˆ", "November 11æœˆ", "December 12æœˆ"
        ];

        // 1. åˆå§‹åŒ–é é¢ï¼šç”¢ç”Ÿ12å€‹æœˆä»½å¡ç‰‡
        function initPage() {
            months.forEach((month, index) => {
                const monthIndex = index + 1;
                const card = document.createElement('div');
                card.className = 'month-card';
                card.innerHTML = `
                    <div class="month-header">
                        <span class="month-tag">${month}</span>
                        <span style="font-size: 1.5rem;">ğŸŒ¸</span>
                    </div>
                    <input type="text" id="title-${monthIndex}" placeholder="è¼¸å…¥é€™å€‹æœˆçš„ä¸»é¡Œ..." oninput="saveData(${monthIndex})">
                    <textarea id="content-${monthIndex}" placeholder="ç™¼ç”Ÿäº†ä»€éº¼æœ‰è¶£çš„äº‹å‘¢ï¼Ÿ..." oninput="saveData(${monthIndex})"></textarea>
                    
                    <div class="img-upload-area" id="area-${monthIndex}" onclick="triggerUpload(${monthIndex})">
                        <div class="upload-placeholder" id="placeholder-${monthIndex}">
                            <div style="font-size: 2rem;">ğŸ“·</div>
                            <div>é»æ“Šä¸Šå‚³ç…§ç‰‡</div>
                        </div>
                        <img id="preview-${monthIndex}" alt="Photo">
                        <input type="file" class="upload-input" id="file-${monthIndex}" accept="image/*" onchange="handleImage(this, ${monthIndex})">
                    </div>
                `;
                container.appendChild(card);
            });
            loadData(); // è¼‰å…¥å·²å„²å­˜çš„è³‡æ–™
        }

        // 2. å¼•å°è¦–çª—æ§åˆ¶
        function closeModal() {
            document.getElementById('intro-modal').style.display = 'none';
        }

        // 3. åœ–ç‰‡ä¸Šå‚³é‚è¼¯
        function triggerUpload(index) {
            document.getElementById(`file-${index}`).click();
        }

        function handleImage(input, index) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.getElementById(`preview-${index}`);
                    const placeholder = document.getElementById(`placeholder-${index}`);
                    const area = document.getElementById(`area-${index}`);
                    
                    img.src = e.target.result;
                    img.style.display = 'block';
                    placeholder.style.display = 'none';
                    area.classList.add('has-image');
                    
                    try {
                        localStorage.setItem(`journal-img-${index}`, e.target.result);
                    } catch (e) {
                        alert("ç…§ç‰‡å¤ªå¤§äº†ï¼Œç€è¦½å™¨å­˜ä¸ä¸‹ ğŸ˜¢ å»ºè­°åŒ¯å‡ºå¾Œå†æ¸…é™¤è³‡æ–™ã€‚");
                    }
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // 4. è³‡æ–™å„²å­˜é‚è¼¯ (LocalStorage)
        function saveData(index) {
            const title = document.getElementById(`title-${index}`).value;
            const content = document.getElementById(`content-${index}`).value;
            localStorage.setItem(`journal-title-${index}`, title);
            localStorage.setItem(`journal-content-${index}`, content);
        }

        // 5. è³‡æ–™è®€å–é‚è¼¯
        function loadData() {
            for (let i = 1; i <= 12; i++) {
                // è®€æ–‡å­—
                if(localStorage.getItem(`journal-title-${i}`)) {
                    document.getElementById(`title-${i}`).value = localStorage.getItem(`journal-title-${i}`);
                }
                if(localStorage.getItem(`journal-content-${i}`)) {
                    document.getElementById(`content-${i}`).value = localStorage.getItem(`journal-content-${i}`);
                }
                
                // è®€åœ–ç‰‡
                const savedImg = localStorage.getItem(`journal-img-${i}`);
                if (savedImg) {
                    const img = document.getElementById(`preview-${i}`);
                    const placeholder = document.getElementById(`placeholder-${i}`);
                    const area = document.getElementById(`area-${i}`);

                    img.src = savedImg;
                    img.style.display = 'block';
                    placeholder.style.display = 'none';
                    area.classList.add('has-image');
                }
            }
        }

        function clearData() {
            if(confirm("ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰ç´€éŒ„å—ï¼Ÿé€™ç„¡æ³•å¾©åŸå–”ï¼")) {
                localStorage.clear();
                location.reload();
            }
        }

        // 6. åŒ¯å‡ºåœ–ç‰‡ (JPG)

function exportToImage() {
    window.scrollTo(0, 0); 
    const element = document.body;
    document.querySelector('.control-bar').style.display = 'none';
    
    // é–‹å•Ÿæ›¿èº«æ¨¡å¼
    prepareForExport(true);

    html2canvas(element, {
        useCORS: true,
        scale: 2, 
        backgroundColor: "#FDFBF7" 
    }).then(canvas => {
        const link = document.createElement('a');
        link.download = '2025_My_Journal.jpg';
        link.href = canvas.toDataURL("image/jpeg", 0.9);
        link.click();
        
        // é—œé–‰æ›¿èº«æ¨¡å¼
        prepareForExport(false);
        document.querySelector('.control-bar').style.display = 'flex';
    }).catch(err => {
        console.error(err);
        prepareForExport(false);
        document.querySelector('.control-bar').style.display = 'flex';
    });
}

        // 7. åŒ¯å‡º PDF
function exportToPDF() {
    window.scrollTo(0, 0);
    const { jsPDF } = window.jspdf;
    const element = document.body;
    document.querySelector('.control-bar').style.display = 'none';

    // é–‹å•Ÿæ›¿èº«æ¨¡å¼
    prepareForExport(true);

    html2canvas(element, {
        scale: 2,
        backgroundColor: "#FDFBF7"
    }).then(canvas => {
        const imgData = canvas.toDataURL('image/jpeg', 1.0);
        
        const pdfWidth = 210; 
        const imgWidth = canvas.width;
        const imgHeight = canvas.height;
        
        const ratio = imgWidth / pdfWidth;
        const pdfHeight = imgHeight / ratio;

        const pdf = new jsPDF('p', 'mm', [pdfWidth, pdfHeight]);
        pdf.addImage(imgData, 'JPEG', 0, 0, pdfWidth, pdfHeight);
        pdf.save('2025_My_Journal.pdf');

        // é—œé–‰æ›¿èº«æ¨¡å¼
        prepareForExport(false);
        document.querySelector('.control-bar').style.display = 'flex';
    }).catch(err => {
        console.error(err);
        prepareForExport(false);
        document.querySelector('.control-bar').style.display = 'flex';
    });
}

        // å•Ÿå‹•
        initPage();
        
        // æª¢æŸ¥æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡è¨ªå•
        if(localStorage.getItem('visited')) {
            document.getElementById('intro-modal').style.display = 'none';
        } else {
            localStorage.setItem('visited', 'true');
        }

/**/
        function toggleInputToText(isExporting) {
    const inputs = document.querySelectorAll('input[type="text"], textarea');
    
    if (isExporting) {
        // æº–å‚™åŒ¯å‡ºï¼šæŠŠ input è—èµ·ä¾†ï¼Œæ›æˆ div
        inputs.forEach(input => {
            // å»ºç«‹æ›¿èº« div
            const div = document.createElement('div');
            div.className = 'export-text-div'; // å¥—ç”¨å‰›å‰›å¯«çš„ CSS
            div.innerText = input.value; // æŠŠè¼¸å…¥çš„å­—è¤‡è£½éå»
            
            // æ¨™è¨˜é€™æ˜¯æ›¿èº«ï¼Œæ–¹ä¾¿ç­‰ä¸‹åˆªé™¤
            div.setAttribute('data-temp-export', 'true'); 
            
            // å¦‚æœæ˜¯æ¨™é¡Œï¼Œå­—é«”å¯ä»¥å¤§ä¸€é»é» (é¸æ“‡æ€§)
            if(input.tagName === 'INPUT') {
                div.style.fontWeight = 'bold';
            }

            // æ’å…¥åˆ° input çš„å‰é¢
            input.parentNode.insertBefore(div, input);
            // éš±è—åŸæœ¬çš„ input
            input.style.display = 'none';
        });
    } else {
        // åŒ¯å‡ºçµæŸï¼šå¾©åŸ
        const tempDivs = document.querySelectorAll('[data-temp-export="true"]');
        tempDivs.forEach(div => div.remove()); // åˆªé™¤æ›¿èº«
        
        inputs.forEach(input => {
            input.style.display = ''; // é¡¯ç¤ºåŸæœ¬ input
        });
    }
}

/**/
function prepareForExport(isExporting) {
    // 1. è™•ç†æ–‡å­—è¼¸å…¥æ¡† (è§£æ±ºæ–‡å­—è¢«åˆ‡æ‰çš„å•é¡Œ)
    const inputs = document.querySelectorAll('input[type="text"], textarea');
    if (isExporting) {
        inputs.forEach(input => {
            const div = document.createElement('div');
            div.className = 'export-text-div';
            div.innerText = input.value;
            div.setAttribute('data-temp-export', 'true');
            if(input.tagName === 'INPUT') div.style.fontWeight = 'bold';
            input.parentNode.insertBefore(div, input);
            input.style.display = 'none';
        });
    } else {
        document.querySelectorAll('[data-temp-export="true"]').forEach(div => div.remove());
        inputs.forEach(input => input.style.display = '');
    }

    // 2. è™•ç†åœ–ç‰‡ (è§£æ±º object-fit å¤±æ•ˆå°è‡´è®Šå½¢çš„å•é¡Œ)
    const imgAreas = document.querySelectorAll('.img-upload-area.has-image');
    if (isExporting) {
        imgAreas.forEach(area => {
            const img = area.querySelector('img');
            if (img) {
                // å»ºç«‹ä¸€å€‹ div ä¾†ç•¶ä½œèƒŒæ™¯åœ–å®¹å™¨
                const div = document.createElement('div');
                div.className = 'export-image-div';
                // å°‡åŸæœ¬åœ–ç‰‡çš„ä¾†æºè¨­ç‚ºèƒŒæ™¯åœ–
                div.style.backgroundImage = `url("${img.src}")`;
                div.setAttribute('data-temp-img', 'true');
                
                area.appendChild(div);
                img.style.display = 'none'; // éš±è—åŸæœ¬çš„ img æ¨™ç±¤
            }
        });
    } else {
        document.querySelectorAll('[data-temp-img="true"]').forEach(div => div.remove());
        imgAreas.forEach(area => {
            const img = area.querySelector('img');
            if(img) img.style.display = 'block'; // æ¢å¾©é¡¯ç¤º
        });
    }
}
    </script>
</body>
</html>